<!DOCTYPE html>
<meta charset="utf-8">
<style>

.chart rect {
  fill: steelblue;
}

.chart text {
  fill: white;
  font: 10px sans-serif;
  text-anchor: end;
}

.legend text{
  fill: black;
  font: 10px sans-serif;
}

</style>

<body>

<button class="seperate_bar">Seperate</button>
<button class="stacked_bar">Stacked</button>

<br><br>

<svg class="chart"></svg>
<svg class="legend"></svg>

<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>

//global variables
var data = [25, 35, 18, 22];
var labels = ['IPO', 'Acquired', 'Open', 'Fail'];

var color = d3.scale.ordinal()
  .range(["#5181c2", "#6ca874", "#e0b84f", "#c2493d"]);

var width = 500,
    height = 40;

var x_scale = d3.scale.linear()
    .domain([0, d3.max(data)])
    .range([0, width]);

//Drawing Seperate
function draw_seperate(data){

  var chart = d3.select(".chart")
      .attr("width", width)
      .attr("height", height * data.length)

  //Rectangles
  var bar = chart.selectAll("rect")
        .data(data)
      .enter().append("rect")
      .style("fill", function(d) { return color(d); });

      chart.selectAll("rect")
        .transition()
        .duration(500).delay(function (d, i) { return i*100} )
        .attr("width", function(d) { return d*5 })
        .attr("height", height - 1)
        .attr("y", function(d, i) {return height*i} )
        .transition()
        .duration(400).ease("bounce")
        .attr("x", 0)

  //Text on the rectangles
      chart.selectAll("text")
          .data(data)
        .enter().append("text")

      chart.selectAll("text")
        .transition()
        .duration(500).delay(function (d, i) { return i*100} )
        .attr("y", function(d, i) {return height*i + 20})
        .attr("dy", ".35em")
        .transition()
        .duration(400).ease("bounce")
        .attr("x", function(d) {return d*5-3; })
        .text(function(d) {return d + "%";});

  //Creating Legend
      var legend = d3.select(".legend")
          .attr("width", width/2)
          .attr("height", height * data.length)

      //squares
      var square = legend.selectAll("rect")
            .data(labels)
            .enter().append("rect")
            .style("fill", function(d) {return color(d); });

      legend.selectAll("rect")
        .attr("class", "square")
        .attr("x", 10)
        .attr("y", function(d,i){return 20 * i})
        .attr("width", 18)
        .attr("height", 18)
        .style("fill", function(d) {return color(d); });

      //labels
      legend.selectAll("text")
            .data(labels)
          .enter().append("text")
        .attr("x", 35)
        .attr("y", function(d,i){return 20 * i + 9})
        .attr("dy", ".35em")
        .text(function(d) {return d});
}


function draw_stacked(data){

  var chart = d3.select(".chart")
      .attr("width", width)
      .attr("height", height * data.length)

  var bar = chart.selectAll("rect")
        .data(data)
      .enter().append("rect")
      .style("fill", function(d) { return color(d); });


      chart.selectAll("rect")
        .transition()
        .duration(500).delay(function (d, i) {return i*100} )
        .attr("width", function(d) { return d*5 })
        .attr("height", height - 1)
        .attr("x", function(d, i) {
                          return (typeof data[i-1] !== 'undefined') ? (data.slice(0,i).reduce(function(a,b) { return a + b}, 0))*5 : 0 } )
        .transition()
        .duration(400).ease("bounce")
        .attr("y", 1)

      chart.selectAll("text")
          .data(data)
        .enter().append("text")

      chart.selectAll("text")
        .transition()
        .duration(500).delay(function (d, i) { return i*100} )
        .attr("x", function(d, i) {
                          return (typeof data[i-1] !== 'undefined') ? (data.slice(0,i+1).reduce(function(a,b) { return a + b}, 0))*5 - 3 : data[0] * 5 -3 } )
        .transition()
        .duration(400).ease("bounce")
        .attr("y", 20)
        .attr("dy", ".35em")
        .text(function(d) {return d + "%";});

}

draw_seperate(data)

//What happens on click
d3.select("button.seperate_bar")
	.on("click", function() {
		draw_seperate(data);
});
d3.select("button.stacked_bar")
	.on("click", function() {
		draw_stacked(data);
});

</script>
</body>
