<!DOCTYPE html>
<meta charset="utf-8">
<style>

.chart rect {
  fill: steelblue;
}

.chart text {
  fill: white;
  font: 10px sans-serif;
  text-anchor: end;
}

</style>

<body>

<button class="seperate_bar">Seperate</button>
<button class="stacked_bar">Stacked</button>

<svg class="chart"></svg>

<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>

//global variables
var data = [45, 35, 5.1, 5.9];

var color = d3.scale.ordinal()
  .range(["#5181c2", "#6ca874", "#e0b84f", "#c2493d"]);

var width = 500,
    height = 40;

var x_scale = d3.scale.linear()
    .domain([0, d3.max(data)])
    .range([0, width]);

// function draw_seperate(data){
//
//   var chart = d3.select(".chart")
//       .attr("width", width)
//       .attr("height", height * data.length)
//
//   var bar = chart.selectAll("g")
//       .data(data)
//     .enter().append("g")
//       .attr("transform", function(d, i) { return "translate(0," + i * height + ")"; });
//
//   bar.append("rect")
//       .transition()
//       .duration(2000)
//       .attr("width", x_scale)
//       .attr("height", height - 1)
//       .style("fill", function(d) { return color(d); });
//
//   bar.append("text")
//       .attr("x", function(d) { return x_scale(d) - 3; })
//       .attr("y", height / 2)
//       .attr("dy", ".35em")
//       .text(function(d) { return d; });
// }

function draw_seperate(data){

  var chart = d3.select(".chart")
      .attr("width", width)
      .attr("height", height * data.length)

  var bar = chart.selectAll("rect")
        .data(data)
      .enter().append("rect")
      .style("fill", function(d) { return color(d); });


      chart.selectAll("rect")
        .transition()
        .duration(1000).delay(function (d, i) { return i*400} )
        .attr("width", function(d) { return d*5 })
        .attr("height", height)
        .attr("x", 0)
        .attr("y", function(d, i) {return height*i} )
}


function draw_stacked(data){

  var chart = d3.select(".chart")
      .attr("width", width)
      .attr("height", height * data.length)



  var bar = chart.selectAll("rect")
        .data(data)
      .enter().append("rect")
      .style("fill", function(d) { return color(d); });


      chart.selectAll("rect")
        .transition()
        .duration(1000).delay(function (d, i) {return i*400} )
        .attr("width", function(d) { return d*5 })
        .attr("height", height)
        .attr("x", function(d, i) {
                          return (typeof data[i-1] !== 'undefined') ? (data.slice(0,i).reduce(function(a,b) { return a + b}, 0))*5 : 0 } )
        .attr("y", 1)

}

// draw_seperate(data)

//What happens on click
d3.select("button.seperate_bar")
	.on("click", function() {
		draw_seperate(data);
});
d3.select("button.stacked_bar")
	.on("click", function() {
		draw_stacked(data);
});

</script>
</body>
